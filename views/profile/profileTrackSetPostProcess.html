
<script type="text/javascript" charset="utf-8">

/**
 * Accesses cachedTrackObj(DB) and appends results .playlist
 *
 * Grabs all track nodes
 * and stores their markup into
 * input[data-encodedobjhtml], then
 * synchronously checks each iCheck
 *
 * Also goes through, sees if usersProfile == user
 * then does the appropriate iChecks
**/

var setList = [{{usersProfile.setList}}]
	
for (var i = 0; i < setList.length; i++) {
	var resourceID = setList[i].toString();
	$.ajax({
		type: 'GET',
		url: '/getCachedTrackObj/' +resourceID,
		async: false,
		success: function(trackObj) {
			$('ul.playlist').append(trackObj.encodedObjHTML);
		}
	});
}

var theTrackSet = [{{user.musicCollection.trackSets.list[0].setList}}];//create 'theTrackSet'
var theTrackSetLen = theTrackSet.length;
var trackSet = [];//onPage tracks
var trackSetDOMNodes = document.querySelectorAll('li.track');
var trackSetLen = trackSetDOMNodes.length;
var inputs = document.querySelectorAll('li.track input');

for (var i = 0; i < trackSetLen; i++) {//trackSetIDs
	trackSet.push(parseInt(inputs[i].id));
}
for (var i = 0; i < trackSetLen; i++) {//put encodedobjhtml into li.track input[i]
	inputs.item(i).dataset.encodedobjhtml = encodeURIComponent(trackSetDOMNodes.item(i).outerHTML.toString());
}
$(inputs).iCheck({//instantiate iCheck
  checkboxClass: 'icheckbox_square-blue',
  increaseArea: '300%',
	aria: false
});
for (var i = 0; i < trackSetLen; i++) {//compare and iCheck any that match theTrackSet
	if(theTrackSet.indexOf(trackSet[i]) !== -1) {//match?
		var tempDiv = $('div.icheckbox_square-blue');           //!REFACTOR
		var tempDivInput = $('div.icheckbox_square-blue input');//!REFACTOR
		$(tempDiv[i]).addClass('checked');                      //!REFACTOR
		$(tempDivInput[i]).prop('checked', true);               //!REFACTOR
	}
};
</script>
